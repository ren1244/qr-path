var QRPath=function(t){"use strict";class e{constructor(t,e,s,n){this.points=[{x:t,y:e},{x:s,y:n}]}concat(t){let e=this.points.pop(),s=t.points[0];if(e.x!==s.x||e.y!==s.y)throw"End point of path1 is not start point of path2";this.points=this.points.concat(t.points)}startPoint(){return this.points[0]}endPoint(){return this.points[this.points.length-1]}}class s{static getKey(t){return t.x+"/"+t.y}constructor(){this.paths=[],this.pathStart=new Map,this.pathEnd=new Map}addPath(t){t=this._concatToStart(t),t=this._concatToEnd(t),this._put(t)}getResult(){return this.paths.filter((t=>null!==t)).map((t=>{let e=t.points,s=[e[0],e[1]];for(let t=2;t<e.length;++t){let n=s.length,a=s[n-2],h=s[n-1],i=e[t];(a.x-h.x)*(i.y-h.y)+(a.y-h.y)*(i.x-h.x)==0?s[n-1]=i:s.push(i)}let n=s[0],a=s[s.length-1];return n.x===a.x&&n.y===a.y&&s.pop(),s}))}_concatToStart(t){let e=s.getKey(t.endPoint()),n=this._take("start",e);return null!==n&&t.concat(n),t}_concatToEnd(t){let e=s.getKey(t.startPoint()),n=this._take("end",e);return null!==n?(n.concat(t),n):t}_take(t,e){let n,a;switch(t){case"start":return this.pathStart.has(e)?(n=this.pathStart.get(e),a=this.paths[n],this.pathStart.delete(e),e=s.getKey(a.endPoint()),this.pathEnd.delete(e),this.paths[n]=null,a):null;case"end":return this.pathEnd.has(e)?(n=this.pathEnd.get(e),a=this.paths[n],this.pathEnd.delete(e),e=s.getKey(a.startPoint()),this.pathStart.delete(e),this.paths[n]=null,a):null;default:throw'_take mode must be "start" or "end"'}}_put(t){let e=this.paths.length;this.paths.push(t);let n=s.getKey(t.startPoint());if(this.pathStart.has(n))throw`pathStart[${n}] 已存在`;this.pathStart.set(n,e);let a=s.getKey(t.endPoint());if(this.pathEnd.has(a))throw`pathEnd[${a}] 已存在`;this.pathEnd.set(a,e)}}return t.QrPath=function(t,n,a){let h=new s;for(let s=0;s<n;++s)for(let i=0;i<t;++i)a(i,s)&&((i-1<0||!a(i-1,s))&&h.addPath(new e(i,s+1,i,s)),(s-1<0||!a(i,s-1))&&h.addPath(new e(i,s,i+1,s)),(i+1>=t||!a(i+1,s))&&h.addPath(new e(i+1,s,i+1,s+1)),(s+1>=n||!a(i,s+1))&&h.addPath(new e(i+1,s+1,i,s+1)));return h.getResult()},Object.defineProperty(t,"__esModule",{value:!0}),t}({});
