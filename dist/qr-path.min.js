var QRPath=function(){"use strict";const t=[null,null,[0,1,0,0],[0,0,1,0],[1,0,1,1],[1,1,0,1]];function n(t){if(!(this instanceof n)){return new n(t).getPath()}this.data=t.data,this.nCols=t.size,this.nRows=parseInt(t.data.length/t.size,10),this.wallCollection=[],this.wallStartIndexDict={},this.wallEndIndexDict={}}return n.prototype.getPath=function(){const t=this.data.length,n=this.nCols,l=this.nRows,i=this.data;for(let e=0;e<t;++e)if(1===i[e]){const t=e%n,s=(e-t)/n;0!==t&&0!==i[e-1]||this._addWall(s,t,2),0!==s&&0!==i[e-n]||this._addWall(s,t,3),t+1!==n&&0!==i[e+1]||this._addWall(s,t,4),s+1!==l&&0!==i[e+n]||this._addWall(s,t,5)}const e=this.wallCollection;let s=[],a=!1;for(let t=0;t<e.length;++t){if(!e[t])continue;a=[];const n=e[t],l=n.mid;l.push(n.start);let i,o=h(n.start,l[0]);for(let t=0;t+1<l.length;++t)i=h(l[t],l[t+1]),i!==o&&(o=i,a.push({x:l[t].x,y:l[t].y}));i=h(l[l.length-1],l[0]),i!==o&&(o=i,a.push({x:l[l.length-1].x,y:l[l.length-1].y})),s.push(a)}return s;function h(t,n){return t.x===n.x?"v":"h"}},n.prototype._addWall=function(n,l,i){let e={start:{x:l+t[i][0],y:n+t[i][1],m:n,n:l},end:{x:l+t[i][2],y:n+t[i][3],m:n,n:l},mid:[]},s=this._insertToWallCollection(e),a=this._searchEnd(e.start);a>-1&&(s=this._margeWall(a,s),e=this.wallCollection[s]),a=this._searchStart(e.end),a>-1&&(s=this._margeWall(s,a),e=this.wallCollection[s])},n.prototype._insertToWallCollection=function(t){const n=t.start.x+","+t.start.y,l=t.end.x+","+t.end.y,i=this.wallCollection.length;return this.wallCollection.push(t),this.wallStartIndexDict[n]?this.wallStartIndexDict[n].push(i):this.wallStartIndexDict[n]=[i],this.wallEndIndexDict[l]?this.wallEndIndexDict[l].push(i):this.wallEndIndexDict[l]=[i],i},n.prototype._searchStart=function(t){const n=t.x+","+t.y;if(!this.wallStartIndexDict[n]||this.wallStartIndexDict[n].length<1)return-1;const l=this.wallStartIndexDict[n];let i;for(i=l.length-1;i>=0;--i){let n=this.wallCollection[l[i]].start,e=(n.n-t.n)*(n.n-t.n)+(n.m-t.m)*(n.m-t.m);if(e<=1||2===e&&(this.data[t.m*this.nCols+n.n]||this.data[n.m*this.nCols+t.n]))return l[i]}return-1},n.prototype._searchEnd=function(t){const n=t.x+","+t.y;if(!this.wallEndIndexDict[n]||this.wallEndIndexDict[n].length<1)return-1;const l=this.wallEndIndexDict[n];let i;for(i=l.length-1;i>=0;--i){let n=this.wallCollection[l[i]].end,e=(n.n-t.n)*(n.n-t.n)+(n.m-t.m)*(n.m-t.m);if(e<=1||2===e&&(this.data[t.m*this.nCols+n.n]||this.data[n.m*this.nCols+t.n]))return l[i]}return-1},n.prototype._margeWall=function(t,n){const l=this.wallCollection[t],i=this.wallCollection[n];if(l.end.x!==i.start.x||l.end.y!==i.start.y)throw"function margeWall: 牆壁無法連結";if(a(this.wallStartIndexDict,i.start.x+","+i.start.y,n),a(this.wallEndIndexDict,i.end.x+","+i.end.y,n),a(this.wallEndIndexDict,l.end.x+","+l.end.y,t),t===n)return t;l.mid.push(l.end);let e=i.mid.length;for(let t=0;t<e;++t)l.mid.push(i.mid[t]);l.end=i.end;const s=l.end.x+","+l.end.y;return this.wallEndIndexDict[s]?this.wallEndIndexDict[s].push(t):this.wallEndIndexDict[s]=[t],this.wallCollection[n]=null,t;function a(t,n,l){if(!t[n])return;const i=t[n];let e=i.indexOf(l);e>-1&&(i[i.length-1]=i[e],i.pop())}},n}();
